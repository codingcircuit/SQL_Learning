# 4. Data Manipulation Language (DML)

- Data Manipulation Language(DML) is a structured query language which is used for inserting, updating and deleting data in the database objects like table or view.
- DML comprises SQL statements which modifies the stored data but not the database object.
- Commonly used DML statements are
    - #### Insert
    - #### Update
    - #### Delete

<br>  


#### INSERT

Below is the script to create Employees and Departments tables (**HR Schema**) along with constraints (**inline specification**)

```sql

rem DROP tables
DROP TABLE department;
DROP TABLE department_copy;

rem CREATE department table
CREATE TABLE department
    ( department_id    NUMBER(4) 
    , department_name  VARCHAR2(30)  CONSTRAINT  dept_name_nn1  NOT NULL
    , manager_id       NUMBER(6)
    , location_id      NUMBER(4)
    , CONSTRAINT dept_id_pk1  		 PRIMARY KEY (department_id)
    ) ;

rem CREATE department_copy table
CREATE TABLE department_copy
    ( department_id    NUMBER(4) 
    , department_name  VARCHAR2(30)  CONSTRAINT  dept_name_nn2  NOT NULL
    , manager_id       NUMBER(6)
    , location_id      NUMBER(4)
    , CONSTRAINT dept_id_pk2  		 PRIMARY KEY (department_id)
    ) ;


rem 1)
rem INSERT using column list
INSERT INTO department (DEPARTMENT_ID, DEPARTMENT_NAME, MANAGER_ID, LOCATION_ID)  
              VALUES     ( 10, 'Administration', 200, 1700);

rem 2)            
rem INSERT without column list - the data should be inserted in the order of columns for all the columns
INSERT INTO department 
              VALUES ( 20, 'Marketing', 201, 1800);

rem 3)
rem INSERT records in an interactive manner
INSERT INTO department VALUES (&DEPARTMENT_ID, '&DEPARTMENT_NAME', &MANAGER_ID, &LOCATION_ID);

rem 4)             
rem INSERT data or copy data from one table to another
INSERT INTO department_copy 
              SELECT * FROM department;

```


<br>

> [!NOTE]
> When SQL for INSERT records in an interactive manner is executed, you will be prompted to enter the values for arguments.  
> Below are the provided values here
>   
> Enter value for DEPARTMENT_ID : 30  
> Enter value for DEPARTMENT_NAME : Purchasing  
> Enter value for MANAGER_ID : 114  
> Enter value for LOCATION_ID : 1700

 ```sql
rem old:
INSERT INTO department VALUES (&DEPARTMENT_ID, '&DEPARTMENT_NAME', &MANAGER_ID, &LOCATION_ID)
``` 
```sql
rem new:
INSERT INTO department VALUES (30, 'Purchasing', 114, 1700)
```

<br>  

<br>  


```sql
select * from department ;
```

![images/insert-table-data.png](https://github.com/venkatdurgempudi/SQL/blob/main/sql-basics/images/insert-table-data.png?raw=true)

<br>  



```sql          
select * from department_copy ;
```
![images/insert-table-data.png](https://github.com/venkatdurgempudi/SQL/blob/main/sql-basics/images/insert-table-data.png?raw=true)

<br>    


#### UPDATE

- Update command is used to change or modify one or more record data in a table.
- When a WHERE condition is specified
    -  first, the records which satisfy the condition are filtered.
    -  then, updation is done only on those records which satisfy the condition.
- All rows will be updated if no condition is specified in where clause.

<br>  


```sql
rem UPDATE using WHERE clause
UPDATE department
SET DEPARTMENT_NAME = 'Single Row Update'
WHERE DEPARTMENT_ID = 10 ;

rem UPDATE without WHERE clause
UPDATE department_copy
SET DEPARTMENT_NAME = 'All Rows Update' ;
``` 


<br>  


```sql
select * from department ;
```

![images/update-table-data-with-where.png](https://github.com/venkatdurgempudi/SQL/blob/main/sql-basics/images/update-table-data-with-where.png?raw=true)

<br>  



```sql          
select * from department_copy ;
```
![images/update-table-data-without-where.png](https://github.com/venkatdurgempudi/SQL/blob/main/sql-basics/images/update-table-data-without-where.png?raw=true)

<br>    



```sql
select * from 
user_constraints
where 1=1
and table_name IN ('EMPLOYEES','DEPARTMENTS');

```

<br>  

 


![images/out-of-line-constraints-before.png](https://github.com/venkatdurgempudi/SQL/blob/main/sql-basics/images/out-of-line-constraints-before.png?raw=true)


<br> 

<br>


> [!IMPORTANT]
> Dropping constraint **DEPT_ID_PK** before dropping **EMP_DEPT_FK** will throw below exception
```sql
Error report -
ORA-02273: this unique/primary key is referenced by some foreign keys
02273. 00000 -  "this unique/primary key is referenced by some foreign keys"
*Cause:    Self-evident.
*Action:   Remove all references to the key before the key is to be dropped.
```

<br>

<br>  


##### Adding constraints out-of-line

```sql
ALTER TABLE departments ADD CONSTRAINT     dept_id_pk     PRIMARY KEY (department_id);
ALTER TABLE employees ADD ( CONSTRAINT     emp_emp_id_pk  PRIMARY KEY (employee_id)
                          , CONSTRAINT     emp_dept_fk    FOREIGN KEY (department_id) REFERENCES departments
                          , CONSTRAINT     emp_salary_min CHECK (salary > 0) 
                          , CONSTRAINT     emp_email_uk   UNIQUE (email) );
```

<br>   

<br>    



```sql
select * from 
user_constraints
where 1=1
and table_name IN ('EMPLOYEES','DEPARTMENTS');

```

<br>  


![images/out-of-line-constraints-after.png](https://github.com/venkatdurgempudi/SQL/blob/main/sql-basics/images/out-of-line-constraints-after.png?raw=true)

<br>  

> #### [Gist File Link](https://gist.github.com/venkatdurgempudi/c39596da09994bc08a675e31b22f7026)

<br>  


<br>  


##### Adding a new column

```sql
ALTER TABLE departments ADD test varchar2(2);
desc departments;
```

Name   |         Null?  |    Type         
--- | --- | ---
DEPARTMENT_ID |  NOT NULL |  NUMBER(4)    
DEPARTMENT_NAME |  NOT NULL |  VARCHAR2(30) 
MANAGER_ID  |              |   NUMBER(6)    
LOCATION_ID  |              |  NUMBER(4)    
TEST     |                 |   VARCHAR2(2)


<br>  


##### Modifying an existing column

```sql
ALTER TABLE departments MODIFY test number(2);
desc departments;
```

Name   |         Null?  |    Type         
--- | --- | ---
DEPARTMENT_ID |  NOT NULL |  NUMBER(4)    
DEPARTMENT_NAME |  NOT NULL |  VARCHAR2(30) 
MANAGER_ID  |              |   NUMBER(6)    
LOCATION_ID  |              |  NUMBER(4)    
TEST     |                 |   NUMBER(2)

<br>  


##### Renaming an existing column

```sql
ALTER TABLE departments RENAME COLUMN test TO test2;
desc departments;
```

Name   |         Null?  |    Type         
--- | --- | ---
DEPARTMENT_ID |  NOT NULL |  NUMBER(4)    
DEPARTMENT_NAME |  NOT NULL |  VARCHAR2(30) 
MANAGER_ID  |              |   NUMBER(6)    
LOCATION_ID  |              |  NUMBER(4)    
TEST2     |                 |   NUMBER(2)

<br>  


##### Deleting an existing column

```sql
ALTER TABLE departments DROP COLUMN test2;
desc departments;
```

Name   |         Null?  |    Type         
--- | --- | ---
DEPARTMENT_ID |  NOT NULL |  NUMBER(4)    
DEPARTMENT_NAME |  NOT NULL |  VARCHAR2(30) 
MANAGER_ID  |              |   NUMBER(6)    
LOCATION_ID  |              |  NUMBER(4)    




<br>  


#### DELETE

Let us create a demo table to demonstrate Truncate usage.

```sql
create table demo as 
select '1' as column1, '2' as column2 from dual
union
select '10','20' from dual
union
select '100','200' from dual
union
select '1000','2000' from dual
union
select '10000','20000' from dual
union
select '100000','200000' from dual
;

select * from 
demo ;
```

<br>  

COLUMN1 |	COLUMN2
--- | ---
1 |	2
10 |		20
100 |		200
1000 |		2000
10000 |		20000
100000 |		200000


<br>  

```sql
TRUNCATE TABLE demo ;

select count(*) from 
demo ;
```

> [!NOTE]
> The above query gives 0 as output
>   
> Truncate will removes all the rows from a table and deallocates the space used by the removed rows. This does not remove the table structure from the database.


<br>  

<br>  

